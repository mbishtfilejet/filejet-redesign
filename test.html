<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Select Dropdowns</title>
        <link rel="stylesheet" href="dist/css/filejet-style.css">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .multi-select-container {
            display: flex;
            gap: 5px;
            padding: 5px;
            min-height: 40px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: white;
            align-items: center;
        }
        .selected-option {
            background-color: #d8dddf;
            padding: 3px 5px;
            border-radius: 2px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 10px;
            color: #6e7683;
            margin-right: 5px;
            font-weight: 500;
           white-space: nowrap;
        }
   
        .selected-option .remove-option {
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .search-input {
            border: none;
            outline: none;
            flex-grow: 1;
            min-width: 50px;
        }
        .dropdown-menu {
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <!-- Jurisdictions Dropdown -->
    <div class="filter2-dropdown col-12 col-lg-3 Jurisdiction-table-col px-1 mb-2 dropdown">
        <div class="multi-select-container" id="jurisdictionContainer" data-bs-toggle="dropdown" aria-expanded="false">
            <input type="text" class="search-input" id="jurisdictionSearch" placeholder="Search Jurisdictions" autocomplete="off">
        </div>
        <ul class="dropdown-menu" id="jurisdictionDropdown">
            <li><label class="dropdown-item"><input type="checkbox" id="jurisdictionSelectAll" class="form-check-input me-2">All</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input jurisdiction-checkbox me-2" value="CA"> CA</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input jurisdiction-checkbox me-2" value="NV"> NV</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input jurisdiction-checkbox me-2" value="FL"> FL</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input jurisdiction-checkbox me-2" value="MN"> MN</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input jurisdiction-checkbox me-2" value="OR"> OR</label></li>
        </ul>
    </div>

    <!-- Task Dropdown -->
    <div class="filter2-dropdown col-12 col-lg-3 task-table-col px-1 mb-2 dropdown">
        <div class="multi-select-container" id="taskContainer" data-bs-toggle="dropdown" aria-expanded="false">
            <input type="text" class="search-input" id="taskSearch" placeholder="Search Tasks" autocomplete="off">
        </div>
        <ul class="dropdown-menu" id="taskDropdown">
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input task-checkbox me-2" value="Annual Report"> Annual Report</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input task-checkbox me-2" value="CTA BOI"> CTA BOI</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input task-checkbox me-2" value="SOP"> SOP</label></li>
        </ul>
    </div>

    <!-- Status Dropdown -->
    <div class="filter2-dropdown col-12 col-lg-3 status-table-col px-1 mb-2 dropdown">
        <div class="multi-select-container" id="statusContainer" data-bs-toggle="dropdown" aria-expanded="false">
            <input type="text" class="search-input" id="statusSearch" placeholder="Search Status" autocomplete="off">
        </div>
        <ul class="dropdown-menu" id="statusDropdown">
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input status-checkbox me-2" value="Overdue"> Overdue</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input status-checkbox me-2" value="Upcoming"> Upcoming</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input status-checkbox me-2" value="Unacknowledged"> Unacknowledged</label></li>
            <li><label class="dropdown-item"><input type="checkbox" class="form-check-input status-checkbox me-2" value="Future"> Future</label></li>
        </ul>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    function setupMultiSelect(containerId, dropdownId, searchInputId, checkboxClass, maxSelection = 2) {
        const searchInput = document.getElementById(searchInputId);
        const dropdown = document.getElementById(dropdownId);
        const multiSelectContainer = document.getElementById(containerId);

        searchInput.addEventListener("input", function () {
            const filter = searchInput.value.toLowerCase();
            const items = dropdown.querySelectorAll(".dropdown-item");

            items.forEach(item => {
                const text = item.innerText.toLowerCase();
                item.style.display = text.includes(filter) ? "" : "none";
            });
        });

        dropdown.addEventListener("change", function (event) {
            if (event.target.classList.contains(checkboxClass)) {
                updateSelectedOptions();
            }
        });

        function updateSelectedOptions() {
            const selectedOptionsContainer = multiSelectContainer;
            const selectedCheckboxes = document.querySelectorAll(`.${checkboxClass}:checked`);
            const selectedValues = Array.from(selectedCheckboxes).map(cb => cb.value);

            selectedOptionsContainer.innerHTML = "";

            selectedValues.slice(0, maxSelection).forEach(value => {
                const span = document.createElement("span");
                span.classList.add("selected-option");
                span.innerHTML = `${value} <span class="remove-option">&times;</span>`;

                span.querySelector(".remove-option").addEventListener("click", function () {
                    const checkbox = [...document.querySelectorAll(`.${checkboxClass}`)].find(cb => cb.value === value);
                    checkbox.checked = false;
                    updateSelectedOptions();
                });

                selectedOptionsContainer.appendChild(span);
            });

            if (selectedValues.length > maxSelection) {
                const extraCount = selectedValues.length - maxSelection;
                const summarySpan = document.createElement("span");
                summarySpan.classList.add("selected-option");
                summarySpan.innerHTML = `+${extraCount}`;
                selectedOptionsContainer.appendChild(summarySpan);
            }

            const input = document.createElement("input");
            input.type = "text";
            input.classList.add("search-input");
            input.id = searchInputId;
            input.placeholder = "";
            input.autocomplete = "off";
            selectedOptionsContainer.appendChild(input);
            input.focus();
        }
    }

    setupMultiSelect("jurisdictionContainer", "jurisdictionDropdown", "jurisdictionSearch", "jurisdiction-checkbox");
    setupMultiSelect("taskContainer", "taskDropdown", "taskSearch", "task-checkbox");
    setupMultiSelect("statusContainer", "statusDropdown", "statusSearch", "status-checkbox");
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


// filter dropdown start
$(document).ready(function () {
  function initializeDropdown(
    dropdownId,
    selectAllId,
    checkboxClass,
    dropdownMenuClass,
    defaultCheckedValues = []
  ) {
    const dropdownInput = $(dropdownId);
    const dropdownMenu = $(dropdownMenuClass);
    const checkboxes = $(checkboxClass);
    const selectAllCheckbox = $(selectAllId);
    const selectedItemsContainer = $('<div class="filter-selected-items-container"></div>');

    // Attach selected items container to the dropdown input field
    dropdownInput.after(selectedItemsContainer);

    function updateInputText() {
      const selectedOptions = checkboxes.filter(":checked").map(function () {
        return $(this).val();
      }).get();

      // Clear previous selected items
      selectedItemsContainer.empty();

      if (selectedOptions.length === 0) {
        selectedItemsContainer.hide();
      } else {
        selectedItemsContainer.show();
        const visibleItems = selectedOptions.slice(0, 2); // Show only first 2 items
        const remainingCount = selectedOptions.length - visibleItems.length;

        // Add the visible selected items
        visibleItems.forEach((option) => {
          const selectedItem = $('<span class="filter-selected-item"></span>').text(option);
          const clearIcon = $('<span class="filter-clear-icon"><img src="dist/images/icons/filter-close.svg" alt="Clear" class="clear-icon-image"/></span>');

          // Attach the clear icon to item
          selectedItem.append(clearIcon);
          selectedItemsContainer.append(selectedItem);

          // Remove item when clicking the clear icon
          clearIcon.on("click", function () {
            $(`input[value="${option}"]`).prop("checked", false);
            updateInputText();
          });
        });

        // Show "+1" summary if more than 2 items selected
        if (remainingCount > 0) {
          const summary = $('<span class="more-items-summary ms-2"></span>').text(`+ ${remainingCount}`);
          selectedItemsContainer.append(summary);
        }
      }
    }

    // Ensure default items are checked
    checkboxes.each(function () {
      const checkboxValue = $(this).val();
      const checkboxLabel = $(this).closest("label").text().trim(); // Get label text

      if (defaultCheckedValues.includes(checkboxValue) || defaultCheckedValues.includes(checkboxLabel)) {
        $(this).prop("checked", true);
      }
    });

    // Trigger input update after setting default checked values
    updateInputText();

    // Filter dropdown options based on input
    dropdownInput.on("input", function () {
      const searchValue = $(this).val().toLowerCase();
      dropdownMenu.find("label").each(function () {
        const label = $(this).text().toLowerCase();
        $(this).toggle(label.includes(searchValue));
      });
    });

    // Handle checkbox changes
    checkboxes.on("change", function () {
      updateInputText();
    });

    // Handle "Select All" checkbox
    selectAllCheckbox.on("change", function () {
      const isChecked = $(this).is(":checked");
      checkboxes.prop("checked", isChecked);
      updateInputText();
    });

    // Sync "Select All" checkbox state
    checkboxes.on("change", function () {
      const allChecked = checkboxes.length === checkboxes.filter(":checked").length;
      selectAllCheckbox.prop("checked", allChecked);
    });

    // Prevent dropdown from closing on click inside
    dropdownMenu.on("click", function (e) {
      e.stopPropagation();
    });
  }

  // Initialize dropdowns with default checked values
  initializeDropdown("#StatusDropdown", "#status-select-all", ".status-checkbox", ".status-dropdown-menu", ["Overdue", "Upcoming", "Unacknowledged"]);
  initializeDropdown("#JurisdictionDropdown", "#jurisdiction-select-all", ".jurisdiction-checkbox", ".jurisdiction-dropdown-menu");
  initializeDropdown("#TaskDropdown", "#task-select-all", ".task-checkbox", ".task-dropdown-menu");
  initializeDropdown("#EntityJurisdictionDropdown", "#entity-jurisdiction-select-all", ".entity-jurisdiction-checkbox", ".entity-jurisdiction-dropdown-menu");
  initializeDropdown("#EntityStatusDropdown", "#entity-status-select-all", ".entity-status-checkbox", ".entity-status-dropdown-menu");
  initializeDropdown("#OrderJurisdictionDropdown", "#order-jurisdiction-select-all", ".order-jurisdiction-checkbox", ".order-jurisdiction-dropdown-menu");
  initializeDropdown("#OrderTaskDropdown", "#order-task-select-all", ".order-task-checkbox", ".order-task-dropdown-menu");
  initializeDropdown("#OrderStatusDropdown", "#order-status-select-all", ".order-status-checkbox", ".order-status-dropdown-menu");

});
// filter dropdown end

