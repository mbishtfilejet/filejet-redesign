<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expandable DataTable</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.dataTables.min.css">
    <style>
        /* General table styling */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        thead th {
            background-color: #f8f9fa;
            text-align: left;
            padding: 10px;
        }
        tbody td {
            padding: 10px;
        }

        /* Styling for expandable rows */
        .expand-row td {
            padding: 0;
            background-color: #f4f4f4;
        }

        .inner-table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            table-layout: fixed;
        }

        .inner-table td {
            padding: 8px;
            border-top: 1px solid #ddd;
        }

        /* Status badges */
        .badge {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: #fff;
            display: inline-block;
        }

        .badge-success {
            background-color: #00ba70;
        }

        .badge-danger {
            background-color: #e73b18;
        }

        .badge-gray {
            background-color: #8690a0;
        }

        /* Colored status dots */
        .status-dots {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .status-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .status-green {
            background-color: #00ba70;
        }

        .status-red {
            background-color: #e73b18;
        }

        .status-gray {
            background-color: #8690a0;
        }

        .status-blue {
            background-color: #3498db;
        }
    </style>
</head>
<body>
    <table id="ra-other-table" class="display responsive nowrap">
        <thead>
            <tr>
                <th></th>
                <th>Group</th>
                <th>Entity Name</th>
                <th>Type</th>
                <th>Jurisdictions</th>
                <th>Registrations</th>
                <th>DBAs</th>
                <th>Bus Licenses</th>
                <th>Status</th>
            </tr>
        </thead>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
    <script>
        // Formatting function for expandable rows
        function format(d) {
            return `
                <tr class="expand-row">
                    <td colspan="9">
                        <table class="inner-table">
                            <tr>
                                <td>${d.group}</td>
                                <td>${d.entity_name}</td>
                                <td>${d.type}</td>
                                <td>${d.jurisdictions}</td>
                                <td>${d.registrations}</td>
                                <td>${d.dbas}</td>
                                <td>${d.bus_licenses}</td>
                                <td>
                                    <span class="badge badge-${d.status.class}">${d.status.label}</span>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            `;
        }

        // Initialize DataTable
        $(document).ready(function () {
            let table = $('#ra-other-table').DataTable({
                ajax: "data4.json",
                columns: [
                    {
                        className: 'dt-control',
                        orderable: false,
                        data: null,
                        defaultContent: ''
                    },
                    { data: 'group' },
                    { data: 'entity_name' },
                    { data: 'type' },
                    { data: 'jurisdictions' },
                    { data: 'registrations' },
                    { data: 'dbas' },
                    { data: 'bus_licenses' },
                    { 
                        data: 'status', 
                        render: renderDots 
                    }
                ],
                order: [[1, 'asc']]
            });

            // Handle row click
            $('#ra-other-table tbody').on('click', 'td.dt-control', function () {
                let tr = $(this).closest('tr');
                let row = table.row(tr);

                if (row.child.isShown()) {
                    row.child.hide();
                    tr.removeClass('expanded-row');
                } else {
                    row.child(format(row.data())).show();
                    tr.addClass('expanded-row');
                }
            });
        });

        // Render dots for status column in the parent row
        function renderDots(data) {
            return `
                <div class="status-dots">
                    <div class="status-dot status-green"></div>
                    <div class="status-dot status-red"></div>
                    <div class="status-dot status-gray"></div>
                    <div class="status-dot status-blue"></div>
                </div>
            `;
        }
    </script>
</body>
</html>
